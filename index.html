<!DOCTYPE html>
<html>
	<head>
		<style>
			/* Floating actions design by Mert Cukuren: https://codepen.io/knyttneve/pen/rGLxbP */
			html, body {
				margin: 0;
				width: 100%;
				height: 100%;
				overflow: hidden;
			}
			
			iframe {
				width: 100%;
				height: 100%;
				border: 0;
			}
			
			.floating {
				position: absolute;
				
				display: flex;
				align-items: center;
				overflow: hidden;
				
				min-height: 60px;
				padding: 0 5px;
				background-color: #fff;
				
				box-sizing: border-box;
				border-radius: 30px;
			}
			
			.floating > a, .floating-inner > a {
				width: 30px;
				height: 30px;
			}
			
			.overlay-actions {
				position: fixed;
				bottom: 0;
				right: 0;
			}
			
			.actions {
				bottom: 25px;
				right: 25px;
				width: 120px;
				justify-content: space-around;
			}
			
			.overlay-search {
				position: fixed;
				top: 0;
				right: calc(50%);
			}
			
			.search {
				top: 88px;
				right: calc(310px / -2 - 80px);
				width: 310px;
				justify-content: center;
				align-items: normal;
				transition: .3s ease 0s;
				flex-direction: column;
			}
			
			.shown > .search > * {
				transition: .2s ease .15s;
			}
			
			.hidden > .search {
				right: -80px;
				width: 0;
				padding: 0 0;
			}
			
			.hidden > .search > * {
				opacity: 0;
				transition: .1s ease 0s;
			}
			
			#search-input {
				height: 60px;
				border: none;
				outline: none;
				width: calc(100% - 75px);
				font-size: 20px;
				padding-left: 15px;
			}
			
			#search-results {
				display: flex;
				flex-direction: column;
				width: 300px;
			}
			
			#search-results * {
				text-decoration: none;
				color: black;
				font-family: sans-serif;
				padding-bottom: 10px;
			}
			
			#search-results a {
				padding-left: 30px;
				font-size: 20px;
				cursor: pointer;
			}
			
			#search-results hr {
				width: 100%;
				margin: 0;
				padding: 0;
				border: 0px solid lightgray;
				margin-top: -5px;
				padding-top: 10px;
				border-top-width: 1px;
			}
			
			#search-results span {
				padding-left: 40px;
				font-size: 14px;
				color: #707070;
			}
			
			.floating-inner {
				display: flex;
				align-items: center;
				justify-content: center;
				overflow: hidden;
				height: 60px;
				box-sizing: border-box;
			}
			
			path {
				stroke-width: 32px;
				fill: none;
				stroke: currentcolor;
				color: #000;
				font-size: 30px;
			}
			
			.sharp {
				fill: #000;
				stroke: none;
			}
		</style>
		<script src="search_map.js"></script>
		<script src="levenshtein.js"></script>
		<script>
			const NEW_PAGE = "https://ltgarchiv.wanderl.com/";
			/*
			let names = Object.keys(search_map);

			let start = Date.now(), hits = 0;
			let duplicates = [];
			for (let i = 0; i < names.length; i++) {
				for (let j = i + 1; j < names.length; j++) {
					hits++
					if (levenshtein(names[i], names[j]) < 3) {
						duplicates.push([names[i], names[j]])
					}
				}
			}
			console.log("Duplicates:", duplicates)
			console.log("Took", (Date.now() - start), "ms (For", hits, "hits)") */
			const get = id => document.getElementById(id)
			// Leitet messages ans content-Frame weiter.
			// (Siehe script in index.htm)
			window.addEventListener("message", (event) => {
				if (event.data === "redirect") {
					window.location.href = NEW_PAGE
				} else
					get("content").contentWindow.postMessage(event.data, '*')
			});
			
			// Suchleiste
			function searchCheck(search, name) {
				let nParts = name.split(" ")

				search:
				for (let sPart of search.split(" ")) {
					for (let nPart of nParts) {
						if (nPart.includes(sPart)) {
							// Teil gefunden
							continue search;
						}
					}
	
					// Teil nicht gefunden
					return false
				}

				// Alle Teile gefunden
				return true
			}
			
			window.addEventListener("load", () => {
				get("btn-toggle-search").addEventListener("click", () => {
					get("search").classList.toggle("hidden")
					get("search").classList.toggle("shown")
					if (get("search").classList.contains("shown")) {
						get("search-input").value = ""
						get("search-input").focus()
					}
				})
				get("btn-close-search").addEventListener("click", () => {
					let resultsDOM = get("search-results")
					while (resultsDOM.children[0]) {
						resultsDOM.removeChild(resultsDOM.children[0])
					}

					get("search").classList.add("hidden")
					get("search").classList.remove("shown")
				})
				
				get("search-input").addEventListener("keyup", function(event) {
					if (event.key === "Enter") {
						event.preventDefault();
					}
					if (event.key === "Escape") {
						get("btn-close-search").click()
						return;
					}

					get("search-input").focus()

					let resultsDOM = get("search-results")
					while (resultsDOM.children[0]) {
						resultsDOM.removeChild(resultsDOM.children[0])
					}

					let text = get("search-input").value.trim().toLowerCase()
					if (text === "") {
						return
					}
					
					let results = [];
					for (let name of Object.keys(search_map)) {
						if (searchCheck(text, name.toLowerCase())) {
							results.push(name)
						}
					}
					
					if (results.length == 0) {
						let span = document.createElement("span")
						span.innerText = `Keine Ergebnisse`;
						resultsDOM.append(span);
					} else {
						let resultsDOM = get("search-results")

						let hr = document.createElement("hr")
						resultsDOM.append(hr);
						let limit = results.length > 11 ? 10 : 11; // "1 weitere" vermeiden, da kann gleich der Name angezeigt werden

						for (let res of results.slice(0, limit)) {
							let a = document.createElement("a")
							a.innerText = res;
							resultsDOM.append(a);
							a.onclick=() => {
								let sr = search_map[res]
								get("content").contentWindow.postMessage('search_hit\n'+window.location+'\n'+sr[0]+'\n'+sr[1], '*')
								get("btn-close-search").click()
							}
						}
	
						if (results.length > 11) {
							let span = document.createElement("span")
							span.innerText = `${results.length - 10} weitere`;
							resultsDOM.append(span);
						}
					}
				});
			});
			
			// Home-Button
			window.addEventListener("load", () => {
				get("btn-new-page").href = NEW_PAGE;
				get("content").contentWindow.postMessage("page_url\n" + NEW_PAGE, "*")
			});
		</script>
	</head>
	<body>
		<iframe src="index.htm" id="content"></iframe>

		<div class="overlay-actions">
			<div class="floating actions">
				<a href="#" id="btn-toggle-search">
					<!-- MIT License, (c) 2015-present Ionic (http://ionic.io) -->
					<svg xmlns="http://www.w3.org/2000/svg" class="ionicon s-ion-icon" viewBox="0 0 512 512">
						<path d="M221.09 64a157.09 157.09 0 10157.09 157.09A157.1 157.1 0 00221.09 64z" stroke-miterlimit="10"></path>
						<path stroke-linecap="round" stroke-miterlimit="10" d="M338.29 338.29L448 448"></path>
					</svg>
				</a>
				<a id="btn-new-page">
					<!-- MIT License, (c) 2015-present Ionic (http://ionic.io) -->
					<svg xmlns="http://www.w3.org/2000/svg" class="ionicon s-ion-icon" viewBox="0 0 512 512">
						<path d="M80 212v236a16 16 0 0016 16h96V328a24 24 0 0124-24h80a24 24 0 0124 24v136h96a16 16 0 0016-16V212" stroke-linecap="round" stroke-linejoin="round"></path>
						<path d="M480 256L266.89 52c-5-5.28-16.69-5.34-21.78 0L32 256M400 179V64h-48v69" stroke-linecap="round" stroke-linejoin="round"></path>
					</svg>
				</a>
			</div>
		</div>
		<div class="overlay-search hidden" id="search">
			<div class="floating search">
				<div class="floating-inner">
					<input placeholder="Name..." id="search-input"></input>
					<a href="#" id="btn-close-search">
						<!-- MIT License, (c) 2015-present Ionic (http://ionic.io) -->
						<svg xmlns="http://www.w3.org/2000/svg" class="ionicon s-ion-icon" viewBox="0 0 512 512">
							<path d="M400 145.49L366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49z" stroke-miterlimit="10" class="sharp"></path>
						</svg>
					</a>
				</div>
				<div id="search-results"></div>
			</div>
		</div>
	</body>
</html>